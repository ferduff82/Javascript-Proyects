<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="jquery-ui/css/ui-lightness/jquery-ui-1.10.4.custom.css">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="stylesheet" type="text/css" href="bootstrap\css\bootstrap.css">
    <link rel="stylesheet" type="text/css" href="bootstrap\css\bootstrap.min.css">
    <script src="jquery-ui/js/jquery-1.10.2.js"></script>
    <script src="jquery-ui/js/jquery-ui-1.10.4.custom.js"></script>
</head>
<body>

<div id="loginContainer">
  <div id="userName"></div>
  <input id="get-users" type="button" value="Login"/>
  <input type="password" name="lastname" id="passLogin" placeholder="Pass">
  <input type="text" name="lastname" id="userLogin" placeholder="User">
</div>

<h3>Control de gastos</h3>

<input type="text" name="lastname" id="categories" placeholder="Ingrese Categoría">
<input id="get-categories" type="button" value="Ingrese Categoría" />
<button type="button" data-toggle="modal" data-target="#myModal" id="removeCategories"
>Remove categories</button>
<br>

<input type="text" name="lastname" id="product" placeholder="Ingrese Producto">
<input type="text" name="lastname" id="price" placeholder="Ingrese Precio" onblur="showFocus(this)">
<input type="text" name="lastname" id="brand" placeholder="Ingrese Marca">
<input type="text" name="lastname" id="kilos" placeholder="Ingrese Cantidad" onblur="showFocus(this)">
<input type="text" name="lastname" id="date" placeholder="Ingrese Fecha">
<select id="category">
  <option value="" disabled selected>Categoria</option>
  <option value="Supermercado">Supermercado</option>
  <option value="Impuestos">Impuestos</option>
  <option value="Salidas">Salidas</option>
  <option value="Varios">Varios</option>
</select>
<br>

<input id="get-values" type="button" value="Ingrese Gasto" />

<div id="demo"></div>
<div id="alert"></div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Remove Categories</h4>
      </div>
      <div class="modal-body" id="removeCategoriesContent">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" id="removeListener">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<script>

/* Modelo de Login */

function getValuesLogin( login ) {

  this.userLogin = document.getElementById('userLogin').value;
  this.passLogin = document.getElementById('passLogin').value;

  var a = this.userLogin;
  var b = this.passLogin;

  if (a === "" || b === "") {
    alert("User or pass can't be empty");
    return false;
  } else {
 
    this.getInfoUser = function () {
      return this.userLogin;
    };

    this.getInfoPass = function () {
      return this.passLogin;
    };
  }
}

/* Modelo de Creación de Compra */

function getValues( product ) {

  this.price = document.getElementById('price').value;
  this.kilos = document.getElementById('kilos').value;
  this.product = document.getElementById('product').value;
  this.date = document.getElementById('date').value;
  this.brand = document.getElementById('brand').value;
  this.category = document.getElementById('category').value;

  var a = isNaN(this.price);
  var b = isNaN(this.kilos);

  if (a === true && b === true) {
    alert("Price and kilos must be numbers");
    return false;
  } else {
 
    this.getInfoProduct = function () {
      return this.product + "  ";
    };

    this.getInfoDate = function () {
      return this.date + "  ";
    };

    this.getInfoPrice = function () {
      return "$" + this.price + "  ";
    };

    this.getInfoKilos = function () {
      return "Cantidad: " + this.kilos + "  ";
    };

    this.getInfoBrand = function () {
      return this.brand + "  ";
    };

    this.getInfoCategory = function () {
      return this.category + "  ";
    };
  }
}

/* Instancias del Modelo de Login */
/* To use ajax in Chrome do this Chrome.exe" --allow-file-access-from-files */

function newLogin (){

   var http_request = new XMLHttpRequest();
   try{
      // Opera 8.0+, Firefox, Chrome, Safari
      http_request = new XMLHttpRequest();
   }catch (e){
      // Internet Explorer Browsers
      try{
         http_request = new ActiveXObject("Msxml2.XMLHTTP");
      }catch (e) {
         try{
            http_request = new ActiveXObject("Microsoft.XMLHTTP");
         }catch (e){
            // Something went wrong
            alert("Your browser broke!");
            return false;
         }
      }
   }
   http_request.onreadystatechange = function (){
      if (http_request.readyState == 4) {

        var jsonObj = JSON.parse(http_request.responseText);

        var nuevoLogin = new getValuesLogin(userLogin);
        var newUser = nuevoLogin.getInfoUser();
        var newPass = nuevoLogin.getInfoPass();

        if (newUser == jsonObj.username && newPass == jsonObj.pass){

          var loggedInAs = "Logged in as ";
          document.getElementById("userName").innerHTML = loggedInAs + jsonObj.username;
          var floatRightUsername = document.getElementById("userName");
              floatRightUsername.classList.add('loginPosition');

          $('#passLogin').remove();
          $('#userLogin').remove();
          $('#get-users').remove();

        var createButtonLogout = document.createElement('input');
            createButtonLogout.setAttribute("id","logoutButton");
            createButtonLogout.setAttribute("value","Logout");
            createButtonLogout.setAttribute("type","button");
        var getLoginDiv = document.getElementById("loginContainer");
            getLoginDiv.appendChild(createButtonLogout);

        /* Bind to event Logout */
        document.getElementById('logoutButton').onclick = newLogout;

        }else{
          document.getElementById("userName").innerHTML = "Not a valid Username or Password";
        }
      }
   }
   http_request.open("GET", "users.json", true);
   http_request.send();
}

function newLogout (){
  document.getElementById('userName').innerHTML="";

  $('#logoutButton').remove();
  
  var createInputButton = document.createElement('input');
      createInputButton.setAttribute("value","Login");
      createInputButton.setAttribute("type","button");
      createInputButton.setAttribute("id","get-users");
  var getLoginDivForButton = document.getElementById("loginContainer");
      getLoginDivForButton.appendChild(createInputButton);

  var createInputPass = document.createElement('input');
      createInputPass.setAttribute("placeholder","Pass");
      createInputPass.setAttribute("type","password");
      createInputPass.setAttribute("id","passLogin");
  var getLoginDivForPass = document.getElementById("loginContainer");
      getLoginDivForPass.appendChild(createInputPass);

  var createInputLogin = document.createElement('input');
      createInputLogin.setAttribute("placeholder","User");
      createInputLogin.setAttribute("type","text");
      createInputLogin.setAttribute("id","userLogin");
  var getLoginDivForLogin = document.getElementById("loginContainer");
      getLoginDivForLogin.appendChild(createInputLogin);

/*
  <input id="get-users" type="button" value="Login"/>
  <input type="password" name="lastname" id="passLogin" placeholder="Pass">
  <input type="text" name="lastname" id="userLogin" placeholder="User">
*/
}

/* Instancias del Modelo de Compra*/
/* Comienzo de la construcción de la compra *//////////////////////////////////////////////////////////////////////////////////////////

function newProduct (){

  var nuevoGasto = new getValues(product);

    /* Validación de Campos vacíos */

    if(nuevoGasto.getInfoCategory() == "  "){
      alert('Debe ingresar una categoría de compra')
      return false
    } else if (nuevoGasto.getInfoProduct() == "  "){
      alert('Debe ingresar un producto')
      return false
    } else if (nuevoGasto.getInfoDate() == "  "){
      alert('Debe ingresar una fecha')
      return false
    } else if (nuevoGasto.getInfoPrice() == "$  "){
      alert('Debe ingresar un precio')
      return false
    }

    /* Push into array */

    var objects = [];

        objects.push(nuevoGasto.getInfoProduct())
        objects.push(nuevoGasto.getInfoDate())
        objects.push(nuevoGasto.getInfoPrice())

        /* Don't push if empty values */

        if (nuevoGasto.getInfoKilos() != "Cantidad:   ") {
          objects.push(nuevoGasto.getInfoKilos())
        }
        if (nuevoGasto.getInfoBrand() != "  ") {
          objects.push(nuevoGasto.getInfoBrand())
        };

        objects.push(nuevoGasto.getInfoCategory())
        alert("Su producto ha sido ingresado con éxito");
        console.log(objects);

        /* Loop array with for with background color change on category select */

        text = "";

        /* Re-search on array to asign color */

        if (nuevoGasto.getInfoKilos() == "Cantidad:   " && nuevoGasto.getInfoBrand() == "  ") {
          var getCategoryValue = objects[3];
        }else if (nuevoGasto.getInfoKilos() == "Cantidad:   " && nuevoGasto.getInfoBrand() != "  ") {
          var getCategoryValue = objects[4];
        }else if (nuevoGasto.getInfoKilos() != "Cantidad:   " && nuevoGasto.getInfoBrand() == "  ") {
          var getCategoryValue = objects[4];
        }else{
          var getCategoryValue = objects[5];
        }

        var getProductIndex = objects.indexOf(nuevoGasto.getInfoProduct());

        var createUl = document.createElement('ul');
        var getDemo = document.getElementById("demo");
        var createRemovePurchaseButton = document.createElement('input');
            createRemovePurchaseButton.setAttribute("type","button");
            createRemovePurchaseButton.setAttribute("value","Borrar Compra");
        var randomId = makeid();
            createRemovePurchaseButton.setAttribute("id",randomId);
            createRemovePurchaseButton.setAttribute("class","borrarCompra");
            getDemo.appendChild(createUl);
            createUl.appendChild(createRemovePurchaseButton);

        for (var i = 0; i < objects.length; i++) {

        var newElem = document.createElement("li");
            newElem.innerHTML = text = objects[i];
        var createEditItem = document.createElement('input');
            createEditItem.setAttribute("type","button");
            createEditItem.setAttribute("value","Editar");
            createEditItem.setAttribute("onclick","changeValues(this)");
            newElem.appendChild(createEditItem);

          if (getCategoryValue == "Supermercado  "){
            var getNumber = makeid();
            createUl.setAttribute("id",getNumber);
            var selectUL = document.getElementById(getNumber);
                selectUL.classList.add('coral')
                selectUL.appendChild(newElem);
          } else if (getCategoryValue == "Impuestos  "){
            var getNumber = makeid();
            createUl.setAttribute("id",getNumber);
            var selectUL = document.getElementById(getNumber);
                selectUL.classList.add('aquamarine')
                selectUL.appendChild(newElem);
          } else if (getCategoryValue == "Salidas  "){
            var getNumber = makeid();
            createUl.setAttribute("id",getNumber);
            var selectUL = document.getElementById(getNumber);
                selectUL.classList.add('chocolate')
                selectUL.appendChild(newElem);
          } else if (getCategoryValue == "Varios  "){
            var getNumber = makeid();
            createUl.setAttribute("id",getNumber);
            var selectUL = document.getElementById(getNumber);
                selectUL.classList.add('crimson')
                selectUL.appendChild(newElem);
          } else {
            var getNumber = makeid();
            createUl.setAttribute("id",getNumber);
            var selectUL = document.getElementById(getNumber);
                selectUL.classList.add('personalizados')
                selectUL.appendChild(newElem);
          }
        }

        /* Remueve los datos del input */

        document.getElementById('product').value=null;
        document.getElementById('date').value=null;
        document.getElementById('price').value=null;
        document.getElementById('kilos').value=null;
        document.getElementById('brand').value=null;

  /* Eventos dentro de final de función */

    /* Borrar Compra */

    var borrarCompra = document.getElementById(randomId);
    borrarCompra.addEventListener("click", remove, false);

    function remove(event){
      console.dir(event);
      debugger
      $(this).parent("ul").remove();
      objects.splice(getProductIndex,7);
      console.log(objects);
      alert("Compra borrada");
      $("#alert").text("Element removido");
      setTimeout(function(){
        document.getElementById('alert').innerHTML="";
      }, 3000);
    }

  /* Tools *////////////////////////////////////

    /* Genera String aleatorias de 5 caracteres */

    function makeid() {
      var text = "";
      var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      for( var i=0; i < 5; i++ )
        text += possible.charAt(Math.floor(Math.random() * possible.length));
      return text;
    }

}

  /* Editar Items */
  function changeValues(arg){
      var edit = prompt("Ingrese el cambio de valor");
      if (edit != null) {
      newProduct.objects.nuevoGasto.getInfoProduct() = edit;
      alert("Cambio realizado con éxito con valor "+edit+"");
    }
  }

/* Fin de la construcción de la compra *//////////////////////////////////////////////////////////////////////////////////////////

/* Agregar categorías */

function createCategories (){

  var getCategorieValue = document.getElementById('categories').value;

  if (getCategorieValue.length<3) {
      alert("Es necesario ingresar 3 letras por categoría por lo menos");
      return false;
  } else {

  var newElem = document.createElement ("option");
  newElem.innerHTML = getCategorieValue;
  var container = document.getElementById ("category");
  container.appendChild (newElem);
  alert("Su categoría "+ getCategorieValue +" se ha ingresado con éxito");

  /* Remueve los datos del input */
  document.getElementById('categories').value=null;
  }
}

/* Remover categorías */

function removeCategories (){
  var txt="";
  var c = document.getElementById('category');
  var selectId = document.getElementById('removeCategoriesContent');

  for (i=0; i<c.length; i++){
    txt = txt + "<li>" + c[i].childNodes[0].nodeValue + "</li>";
  };

  selectId.innerHTML = "<ul id='newUl'>" + txt + "</ul>";
  var getUlId = document.getElementById("newUl");

  /*
  var addEventRemove = function (event) {
    var target = event.target;
    alert(target.nodeName + "");
    alert(target.index);

    var txt = "";

    for (i=0; i<event.length; i++){
      txt = txt + "\n" + event[i].index;
    }
  };

  var selectAllLi = document.getElementById('removeCategoriesContent');
  selectAllLi.addEventListener("click", addEventRemove, false);

  function removeListener () {
    selectAllLi.removeEventListener('click', addEventRemove, false);
  };

  document.getElementById('removeListener').onclick = removeListener;
  */

  $("li").click(function(){
    var getIndex = $(this).index() + 1;
    alert(getIndex);
    $("#category").indexOf.remove();


  });

}

/* Evaluar OnBlur si son números o no */

function showFocus(elem) {
  var age = elem.value;
  if (isNaN(age)) {
    alert('Debe ingresar solo números');
    elem.style.backgroundColor = 'red';
  }
}

/* Eventos */

document.getElementById('get-values').onclick = newProduct;
document.getElementById('get-categories').onclick = createCategories;
document.getElementById('get-users').onclick = newLogin;
document.getElementById('removeCategories').onclick = removeCategories;

/* Evento datepicker */

$( function() {
  $( "#date" ).datepicker();
});

/*
var test = "hola";
function alertar(bla){
  alert(bla);
}
alertar(test);
*/

</script>
<script src="bootstrap\js\bootstrap.min.js"></script>
</body>
</html>